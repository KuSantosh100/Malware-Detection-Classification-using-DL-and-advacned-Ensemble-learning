import streamlit as st
import tensorflow as tf
import numpy as np


def model_prediction(test_image):
    model = tf.keras.models.load_model("ensemble_newdata_model.h5")
    image = tf.keras.preprocessing.image.load_img(test_image,target_size=(75,75))
    input_arr = tf.keras.preprocessing.image.img_to_array(image)
    input_arr = np.array([input_arr])
    predictions = model.predict(input_arr)
    return np.argmax(predictions)


class_name =[
              'Adposhel',
              'Agent',
              'Allaple',
              'Alueron.gen!J',
              'Amonetize',
              'Androm',
              'Autorun',
              'BrowseFox',
              'C2LOP.gen!g',
              'Dialplatform.B',
              'Dinwod',
              'Elex',
              'Expiro',
              'Fakerean',
              'Fasong',
              'HackKMS',
              'Hlux',
              'Injector',
              'InstallCore',
              'Lolyda.AA1',
              'Lolyda.AA2',
              'MultiPlug',
              'Neoreklami',
              'Neshta',
              'Regrun',
              'Sality',
              'Snarasite',
              'Stantinko',
              'VBA',
              'VBKrypt',
              'Vilsel']

st.header("Malware Detection + Classificationüëæüíª‚ò†Ô∏è")
st.markdown("""
            ### About Dataset
            MalImg Dataset: 
            Total Images : 9339 images
            The dataset(MalImg) consist of gray scale images.It is imbalanced dataset.
            
            MalVis Dataset:
            Total Images : 9100 images
            The Dataset(Malvis) is a balanced Dataset. It consist of RGB images.
            
            Proposed Dataset:
            Total Images : 9868 images
            Proposed dataset is a Semibalance dataset.
            ###
            """)



with st.expander("DATASET LINKS üìö"):
    st.write("MalVis Dataset [link](https://www.kaggle.com/datasets/sohamkumar1703/malevis-dataset)")
    st.write("MalImg Dataset [link](https://www.researchgate.net/figure/Data-description-of-Malimg-Dataset_tbl4_358664952)")
    st.write("Proposed Dataset [link](https://drive.google.com/file/d/1-4-5w0dKMqfRmOTcS8PcWj-gifTvsyg4/view?usp=drive_link)")

test_image = st.file_uploader("Choose an Image:")
if(st.button("Show Image")):
    st.image(test_image,width=4,use_column_width=True)
#Predict button
if(st.button("Predict")):
    st.write("Our Prediction")
    result_index = model_prediction(test_image)
    
    st.success("Our Model is Predicting it's a {}".format(class_name[result_index]))
    st.balloons()
    st.image(test_image,width=4,use_column_width=True)